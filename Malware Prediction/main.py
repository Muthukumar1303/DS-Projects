# -*- coding: utf-8 -*-
"""
Created on Mon Jan 10 13:49:15 2022

@author: postulate-41
"""

from os import listdir
from PIL import Image
import os.path
import numpy as np
import cv2
import pandas as pd

import tensorflow as tf
import numpy as np
import pandas as pd


import easygui 
import tkinter

import warnings
warnings.simplefilter('always')

Model=tf.keras.models.load_model("best_model.h5")

def get_array(path):
    h = 100 #height of image
    w = 100 #width of image
    
    #be careful with using this function, it will consume memory, access to disk and time
    images = []
    #path = 'train/0BEsCP7NAUy8XmkenHWG.asm'
    with open(path, 'rb') as img_set:
        img_arr = img_set.read(h*w)
        img_arr2 = img_set.read()
        
        while img_arr:
            if len(img_arr) == h*w :
                images.append(img_arr)
            img_arr = img_set.read(h*w)
    
    #And you can save them into png files
    count = 0
    for img in images:
        png = Image.fromarray(np.reshape(list(img), (h,w)).astype('float32'), mode='L')
        png.save('image_file.jpg')
        count += 1
    arr=cv2.imread('image_file.jpg',0)
    return arr



path=easygui.fileopenbox(msg="Please Select THe Malware file..")

test_image=get_array(path)
X=[]
X.append(test_image)
Xd=np.array(X)
Xd=Xd.reshape(Xd.shape[0],Xd.shape[1],Xd.shape[2],1)



predicted=Model.predict(Xd)

predicted=list(predicted[0])
p1=max(predicted)
p2=predicted.index(p1)

# ans=p2+1
malware=['amnit',
'Lollipop',
'Kelihos_ver3',
'Vundo',
'Simda',
'Tracur',
'Kelihos_ver1',
'Obfuscator.ACY',
'Gatak'
]

print("Predicted Malware is:",malware[p2])


